<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <title>Document</title>
</head>

<body>


    <div class="container text-center">
        <table class="mb-10">

            <tr>
                <td>
                    Mã sản phẩm
                </td>
                <td>
                    <input type="text" id="txtMa" width="200">
                </td>
            </tr>
            <tr>
                <td>
                    Tên sản phẩm
                </td>
                <td>
                    <input type="text" id="txtTen" width="200">
                </td>
            </tr>
            <tr>
                <td>
                    Chất liệu 
                </td>
                <td>
                    <input type="text" id="txtChatLieu" width="200">
                </td>
            </tr>
            <tr>
                <td>
                    Mô tả
                </td>
                <td>
                    <input type="text" id="txtMoTa" width="200">
                </td>
            </tr>
            <tr>
                <td>
                    Giá nhập
                </td>
                <td>
                    <input type="text" id="txtGiaNhap" width="200">
                </td>
            </tr>
            <tr>
                <td>
                    Giá bán
                </td>
                <td>
                    <input type="text" id="txtGiaBan" width="200">
                </td>
            </tr>
            <tr>
                <td>
                    Số lượng
                </td>
                <td>
                    <input type="text" id="txtSoLuong" width="200">
                </td>
            </tr>
            <tr>
                <td>
                    <button id="btnAdd" class="btn-primary btn" onclick="AddProduct();"> Thêm mới</button>
                </td>
                <td>
                    <button id="btnSua" class="btn-secondary btn" onclick="EditProduct();"> Sửa</button>
                </td>
            </tr>
        </table>

        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Mã</th>
                    <th>Tên</th>
                    <th>Chất liệu</th>
                    <th>Mô tả</th>
                    <th>Giá nhập</th>
                    <th>Giá bán</th>
                    <th>Số lượng</th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="allPD">
            </tbody>
        </table>
    </div>





    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.min.js"
            integrity="sha512-ykZ1QQr0Jy/4ZkvKuqWn4iF3lqPZyij9iRv6sGqLRdTPkY69YX6+7wvVGmsdBbiIfN/8OdsI7HABjvEok6ZopQ=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
            integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        $(document).ready(function () {
            GetallProduct()
        });

        function GetallProduct() {
            $.ajax({
                url: "http://127.0.0.1:5000/sp/getallproduct",
                method: "GET",
                contentType: "application/json",
                dataType: "json",
                success: function (res) {
                    const len = res.length;
                    console.log(res);
                    let table = ""
                    for (var i = 0; i < len; i++) {
                        table += "<tr>"
                        table += "<td>" + res[i].MaSP + "</td>"
                        table += "<td>" + res[i].TenSP + "</td>"
                        table += "<td>" + res[i].ChatLieu + "</td>"
                        table += "<td>" + res[i].MoTa + "</td>"
                        table += "<td>" + res[i].GiaNhap + "</td>"
                        table += "<td>" + res[i].GiaBan + "</td>"
                        table += "<td>" + res[i].SoLuong + "</td>"
                        table += "<td><button class='btn btn-primary' onclick='handleEditBtnClick("+res[i].MaSP+")'>Sửa</button></td>"
                        table += "<td><button class='btn btn-danger' onclick='DeleteProduct(" + res[i].MaSP + ")'>Xóa</button></td>"
                        table += "</tr>"

                    }
                    document.getElementById("allPD").innerHTML = table;
                }
            })
        }
        function AddProduct() {
            const MaSP = document.getElementById("txtMa").value;
            const TenSP = document.getElementById("txtTen").value;
            const ChatLieu = document.getElementById("txtChatLieu").value;
            const MoTa = document.getElementById("txtMoTa").value;
            const GiaNhap = document.getElementById("txtGiaNhap").value;
            const GiaBan = document.getElementById("txtGiaBan").value;
            const SoLuong = document.getElementById("txtSoLuong").value;
            const data = {
                masp: MaSP,
                tensp: TenSP,
                chatieu: ChatLieu,
                mota: MoTa,
                gianhap: GiaNhap,
                giaban: GiaBan,
                soluong: SoLuong
            }
            $.ajax({
                url: "http://127.0.0.1:5000/sp/add",
                method: "POST",
                contentType: "application/json",
                dataType: "json",
                data: JSON.stringify(data),
                success: function (res) {
                    console.log(res);
                    GetallProduct()
                }
            })
        }
        function EditProduct(id) {
            const MaSP = document.getElementById("txtMa").value;
            const TenSP = document.getElementById("txtTen").value;
            const ChatLieu = document.getElementById("txtChatLieu").value;
            const MoTa = document.getElementById("txtMoTa").value;
            const GiaNhap = document.getElementById("txtGiaNhap").value;
            const GiaBan = document.getElementById("txtGiaBan").value;
            const SoLuong = document.getElementById("txtSoLuong").value;
            const data = {
                MaSP: MaSP,
                TenSP: TenSP,
                ChatLieu: ChatLieu,
                MoTa: MoTa,
                GiaNhap: GiaNhap,
                GiaBan: GiaBan,
                SoLuong: SoLuong
            }
            $.ajax({
                url: "http://127.0.0.1:5000/sp/update",
                method : "PUT",
                dataType : "json",
                contentType : "application/json",
                data : JSON.stringify(data),
                success : function(res){
                    console.log(res);
                    GetallProduct()
                }
            })
        }
        function DeleteProduct(id) {
            $.ajax({
                url: "http://127.0.0.1:5000/sp/delete/" + id,
                method: "DELETE",
                contentType: "application/json",
                dataType: "json",
                success: function (res) {
                    console.log(res);
                    GetallProduct()
                }
            })
        }
        function handleEditBtnClick(id) {
            const MaSP = document.getElementById("txtMa").value;
            const TenSP = document.getElementById("txtTen").value;
            const ChatLieu = document.getElementById("txtChatLieu").value;
            const MoTa = document.getElementById("txtMoTa").value;
            const GiaNhap = document.getElementById("txtGiaNhap").value;
            const GiaBan = document.getElementById("txtGiaBan").value;
            const SoLuong = document.getElementById("txtSoLuong").value;
            $.ajax({
                url: "http://127.0.0.1:5000/sp/getbyid/" + id,
                method: "GET",
                dataType: "json",
                contentType: "application/json",
                success: function (res) {
                    console.log(res);
                    document.getElementById("txtMa").value = res[0].MaSP;
                    document.getElementById("txtTen").value = res[0].TenSP;
                    document.getElementById("txtChatLieu").value = res[0].ChatLieu;
                    document.getElementById("txtMoTa").value = res[0].MoTa;
                    document.getElementById("txtGiaNhap").value = res[0].GiaNhap;
                    document.getElementById("txtGiaBan").value = res[0].GiaBan;
                    document.getElementById("txtSoLuong").value = res[0].SoLuong;
                }
            })
        }
    </script>
</body>

</html>